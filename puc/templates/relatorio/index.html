{% extends "base.html" %}

{% block title %}Relatorio{% endblock %}

{% block stylesheet %}

<!--link rel="stylesheet" type="text/css" href="/media/css/forms.css" /-->
<!--link rel="stylesheet" type="text/css" href="/media/css/widgets.css" /-->
<link rel="stylesheet" type="text/css" href="/media/css/relatorio.css" />

<!-- Calendario JS -->
<link rel="stylesheet" type="text/css" href="/media/css/jscal2.css" />
<link rel="stylesheet" type="text/css" href="/media/css/border-radius.css" />
<link rel="stylesheet" type="text/css" href="/media/css/win2k/win2k.css" />

{% endblock %}
	
{% block javascript %}
<script src="/media/js/jsi18n.js" type="text/javascript"></script>
<script src="/media/js/core.js"></script>
<script src="/media/js/application.js" type="text/javascript"></script>
<!--
<script src="/media/js/dateparse.js"></script>
<script src="/media/js/timeparse.js"></script>
<script src="/media/js/calendar.js"></script>
<script src="/media/js/admin/DateTimeShortcuts.js" type="text/javascript"></script>
-->
<script src="/media/js/sme2_relatorio.js"></script>

<script src="/media/js/jscal2.js"></script>
<script src="/media/js/pt.js"></script>


<script type="text/javascript">//<![CDATA[

  function calendario() {
	  var cal = Calendar.setup({
	      onSelect: function(cal) { cal.hide() }
	  });
	  
	  cal.manageFields("id_btn_data_inicio", "id_data_inicio", "%Y-%m-%d");
	  cal.manageFields("id_btn_data_fim", "id_data_fim", "%Y-%m-%d");
  }


//]]></script>


<script type="text/javascript">
	var produtos_alarmes_json = {{ produtos_alarmes|safe }}
	var alarmes_monitores_json = {{ alarmes_monitores|safe }}

	/*Funcao para adicionar o efeito do slide nos boxes*/
	function init() {
		//console.log("body loaded")
		
		calendario();
		
		this.options = {
	      portal: 'portal',
	      column: 'portal-column',
	      block: 'block',
	      content: 'content',
	      handle: 'handle',
	      hoverclass: 'block-hover',
	      toggle: 'block-toggle',
	      blocklist: 'portal-column-block-list',
	      blocklistlink: 'portal-block-list-link',
	      blocklisthandle: 'block-list-handle',
	    }
	
	    var blocks = document.getElementsByClassName(
	      this.options.block, this.options.portal
	    );
	
	    blocks.each(
	      function (block) {
	        var content = Element.childrenWithClassName(
	          block, this.options.content, true
	        );

	        var toggle = Element.childrenWithClassName(
	          block, this.options.toggle, true
	        );
	        Event.observe(
	          toggle, 'click', 
	          function (e) { Effect.toggle(content, 'Slide'); },
	          false
	        );

	      }.bind(this)
	    );
		
		/*
		for (var container in settings) {
	      settings[container].each(function (block) {
	        $(container).appendChild($(block));
	      });
	    }
		*/
		
		destacaTooltip();
		Event.observe('id-relatorio-tooltip', 'mouseover', destacaTooltip, false);
		//Event.observe('id-relatorio-tooltip', 'click', clickTooltip, false);
			
	}
	Event.observe(window, 'load', init, false);
    
</script>


{% endblock %}

{% block content %}
<div id="portal">
	<div class="block" id="block-relatorio">
		<h3 class="handle"><a class="block-toggle"><span>toogle</span></a><a name="relatorio">Relatorio</a></h3>
		<div class="content">
			{% if erro %}
			<center><h2><font color=red>Por favor, preenche todos os campos</font></h2></center>
			{% endif %}
			<form name='frm' method=POST action=''>
				<span>Produto/Alarme/Monitor: </span><br>
				<!-- produto -->
				
				<select name=produto onChange='adicionaAlarmes(this.options[this.selectedIndex].value);'>
					<option value="0">[Selecione um produto]</option>
					{% for produto in produtos %}
						<option id="prd_{{ produto.prd_id }}" value="{{ produto.prd_id }}" {% ifequal produto.prd_id|safe request.POST.produto|safe %} selected{% endifequal %}>{{ produto.prd_nome }}</option>
					{% endfor %}
				</select>
				
				<!-- alarme -->
				<select name=alarme onChange='adicionaMonitores(this.options[this.selectedIndex].value);'>
					{% if alarmes %}
						<option value="0">[Selecione um alarme]</option>
						{% for alarme in alarmes %}
								<option id="alm_{{ alarme.prd_id }}" value="{{ alarme.alm_id }}" {% ifequal alarme.alm_id|safe request.POST.alarme|safe %} selected{% endifequal %}>{{ alarme.alm_nome }}</option>
						{% endfor %}
					{% else %}
							<option value="0" selected>[Selecione um alarme]</option>
					{% endif %}
				</select>
				<!-- monitor -->
				<!--select name=monitor onChange='document.frm.submit();'-->
				<select name=monitor onChange=''>
					{% if monitores %}
						<option value="0">[Selecione um monitor]</option>
						{% for monitor in monitores %}
							<option id="mon_{{ monitor.mon_id }}" value="{{ monitor.mon_id }}" {% ifequal monitor.mon_id|safe request.POST.monitor|safe %} selected{% endifequal %}>{{ monitor.mon_nome }}</option>
						{% endfor %}
					{% else %}
						<option value="0" selected>[Selecione um monitor]</option>
					{% endif %}
				</select>
				<!-- Periodo -->
				<h2><center>Período</center></h2>
				<table>
				<tr>
					<th>Início:</th>
					<td><input id="id_data_inicio" type="text" name="data_inicio" size="10" value="{{request.POST.data_inicio}}"/><a id="id_btn_data_inicio" href='#' onclick="calendario();"><img src='/media/images/icon_calendar.gif'></a></td>
				</tr>
				<tr>
					<th>Término:</th>
					<td><input id="id_data_fim" type="text" name="data_fim" size="10" value="{{request.POST.data_fim}}"/><a id="id_btn_data_fim" href='#' onclick="calendario();"><img src='/media/images/icon_calendar.gif'></a></td>
				</tr>
				</table>
				<center><input type="submit" value="gerar relatório"></center>
			</form>
			</br>
			<div id="colunas"></div>
		</div>
	</div>
	<div id="relatorio">
		{% if relatorio %}
			{{ relatorio.get_html|safe }}
		{% endif %}
	</div>

</div>


{% endblock %}

